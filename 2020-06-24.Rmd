---
title: '2020-06-24'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.





5.4 Iterationè¿´åœˆ
Rule of thumb: never copy and paste more than twice.

é‡è¦†å…©æ¬¡ï¼ˆåŒ…å«ç¬¬ä¸€å€‹ï¼‰å¯ä»¥
ä½†åœ¨è¨­è¨ˆè¿´åœˆæ™‚å¯ä»¥copy/paste 3 timesä¾†ç†è§£bodyå¦‚ä½•è¨­è¨ˆ
è¿´åœˆï¼šä¸€é€£ä¸²ç¨‹åºåè¦†åŸ·è¡Œæ™‚ä½¿ç”¨çš„
æ‰¾å‡ºå“ªå¹¾ç­†ç‚ºâ€œç”·â€ï¼š
```{r}
sampleData <- list(
  list("ç”·", 45), list("å¥³", 32), list("ç”·",50), list("ç”·",33), list("å¥³", 21)
)
```


ç”·å¥³åªåœ¨sampleDataæ¯ä¸€å€‹å…ƒç´ åº•ä¸‹çš„ç¬¬ä¸€å€‹å…ƒç´ 
```{r}
# å‰ä¸‰ç­†æ€§åˆ¥
sampleData[[1]][[1]]
sampleData[[2]][[1]]
sampleData[[3]][[1]]
```

è‹¥èƒ½å–å‡ºæ¯ä¸€ç­†çš„æ€§åˆ¥å½¢æˆä¸€å€‹class charactor vector, å–ågender, é‚£å°±å¯ä»¥:
```{r}
pick_male <- (gender == "ç”·")
```

ğŸ’¡ â€œå°äº†mapå‡½æ•¸ç”¨ä¾†é€²è¡Œä¸€ä¸€è™•ç†è€Œä¸”å¯ä»¥è¼¸å‡ºæˆä¸€å€‹list, è€Œunlistå¯ä»¥é©ç•¶æŠŠlistè®Šæˆatomic vectorâ€
```{r}
map(sampleData,~.x[[1]]) %>%
  unlist() -> gender

pick_male <- (gender == "ç”·")
```
è‹¥ä½ ç¢ºä¿¡ä½ mapçš„listè¼¸å‡ºæ¯å€‹å…ƒç´ åªæœ‰ä¸€å€‹å€¼ï¼Œä¸”å¤§å®¶éƒ½ç›¸åŒclassï¼Œå‰‡ä½ å¯ä»¥ä¾classçš„é¡å½¢ä½¿ç”¨ï¼š
map_chr
map_lgl
map_dbl, map_int
çœäº†unlisté‚£ä¸€æ­¥ã€‚
```{r}
map_chr(sampleData,~.x[[1]]) -> gender
```

ex:è©¦è©¦çœ‹èƒ½ä¸èƒ½ä¸€mapç™»å¤©ï¼Œä¸€æ­¥å°±ç”¢ç”Ÿä½ è¦çš„pick_maleã€‚



5.4.1 Iteration components
æˆ‘å€‘åœ¨ä½¿ç”¨mapæ™‚å¯«copy/pasteç¨‹åº3æ¬¡ï¼Œç›®çš„åœ¨ç¢ºèªï¼š
Sequence: å³[[1]], [[2]], [[3]]å‡ºç¾çš„ä½ç½®ã€‚
Body: è¦é‡è¦†åšçš„SOPï¼Œå³~.x[[1]]ã€‚
è€Œmapæœ€å¾ŒæœƒæŠŠæ¯æ¬¡Bodyçš„åŸ·è¡Œçµæœå­˜åœ¨ï¼š
Output: æ¯æ¬¡bodyåŸ·è¡Œå®Œè¦å­˜çš„å½¢å¼ï¼Œå³mapæœ€å¾Œçš„list class outputã€‚
**ä½¿ç”¨å–å‡ºçš„ä¸‰å€‹ç¬¦è™Ÿéƒ½æ˜¯functionï¼Œæ‰€ä»¥å¯ä»¥ç”¨pipeå°‡åƒæ•¸xæå‡º

5.4.2 Two types of sequence
åè¦†è¦åšçš„äº‹
```{r}
sampleData[[1]][[1]]  
sampleData[[2]][[1]] 
sampleData[[3]][[1]] 
```

ä½¿ç”¨pipeå¯«æ³•å¯ä»¥æ¸…æ¥šåˆ†é›¢sequenceåŠbody(SOP)ã€‚å…©ç¨®sequenceè¡¨ç¤ºï¼š
```{r}
library(magrittr)
# ä¸²æ¥å¯«æ³•(I): external dispatchï¼šæº–å‚™è¦é‹ä½œçš„æ±è¥¿åœ¨å·¥å» ï¼ˆå¤§æ‹¬è™Ÿï¼‰ä»¥å¤–æº–å‚™å¥½ä»¥å¾Œæ‰ä¸Ÿåˆ°å·¥å» è£¡çµ„è£
sampleData[[1]] %>% {.[[1]]} 
sampleData[[2]] %>% {.[[1]]}
sampleData[[3]] %>% {.[[1]]}

map(sampleData, ~{.x[[1]]})

# ä¸²æ¥å¯«æ³•(II): internal dispatchï¼šåŸæ–™éƒ½ä¸€ç›´åœ¨å·¥å» ï¼ˆå¤§æ‹¬è™Ÿï¼‰è£¡é¢ï¼Œåªæœ‰åœ¨è¢«å»£æ’­æ™‚ï¼Œç‰©ä»¶åŸæ–™çš„ç¬¬ä¸€å€‹å…ƒç´ å°±æœƒç«™å‡ºä¾†ç¶“éå·¥å» è£¡çš„ç”Ÿç”¢ç·š
1 %>% {sampleData[[.]][[1]]}  
2 %>% {sampleData[[.]][[1]]}  
3 %>% {sampleData[[.]][[1]]}

map(1:5, ~{sampleData[[.]][[1]]}) #mapåœ¨å–®ç¶­åº¦éè¿´æ™‚ï¼Œ.xä¹Ÿå¯ä»¥åªå¯«.ï¼Œä½†å»ºè­°é‚„æ˜¯å¯«.
```

```{r}
eggs <- rep("é›è›‹x1", 8)

fryEgg <- function(egg){
  str_replace(egg, "é›è›‹", "è·åŒ…è›‹")
}

# external dispatch
eggs[[1]] %>% fryEgg(.)
eggs[[2]] %>% fryEgg(.)
eggs[[3]] %>% fryEgg(.)
#ç”¨mapè©®é‡‹map(eggs,~fryEgg(.x))
map(eggs, ~fryEgg(.x)) -> friedEggs1

# internal dispatch
1 %>% {fryEgg(eggs[[.]])} #è¨˜å¾—åŠ å¤§æ‹¬è™Ÿ
2 %>% {fryEgg(eggs[[.]])}
3 %>% {fryEgg(eggs[[.]])}
#ç”¨mapè©®é‡‹map(1:8,~{fryEgg(eggs[[.x]])})
map(1:8,~{fryEgg(eggs[[.x]])}) -> friedEggs2
```


vectorized function
functionçš„input argumentï¼Œæˆ‘å¯ä»¥æŠŠä¸€å€‹å‘é‡ä¸ç®¡é•·åº¦ä¸Ÿé€²å»ï¼Œä»–éƒ½æœ‰è¾¦æ³•è™•ç†çš„è©±ï¼Œæ­¤ç¨®å‡½æ•¸å°±ç¨±ç‚ºvectorized function
```{r}
grade <- c(45, 74, NA)

i<-3

grade_i <- grade[[i]]
if(!is.na(grade_i)){
  if(grade_i >= 60){
    "P"
  } else if(grade_i < 60 ) {
    "F"
  }
} else {
  "ç¼ºè€ƒ"
}
```

```{r}
pass_or_fail <- function(grade_i){
  if(!is.na(grade_i)){
    if(grade_i >= 60){
      "P"
    } else if(grade_i < 60 ) {
      "F"
    }
  } else {
    "ç¼ºè€ƒ"
  }
}

pass_or_fail(grade[[1]])
pass_or_fail(grade[[2]])
pass_or_fail(grade[[3]])

# å¯å¦ç›´æ¥inputæ•´å€‹grade vector
warning("ä¸æ˜¯vectorised function")
pass_or_fail(grade)
```


å‡½æ•¸ä½¿ç”¨æ™‚è‹¥å‡ºç¾output value assignedå‹•ä½œæ™‚ï¼ˆå³pass_fail_i <-ï¼‰ï¼Œç›¸ç•¶æ–¼åŸ·è¡Œäº†å‡½æ•¸body pass_fail_i <-{...}ï¼Œä¾switchå°ç¯€çš„{...}è™•ç†åŸå‰‡ï¼š

è‹¥æœ€å¾Œä¸€å€‹è¢«åŸ·è¡Œçš„æŒ‡ä»¤æœƒç”¢ç”Ÿprintåœ¨è¢å¹•çš„æ•ˆæœï¼Œå‰‡å¯ä»¥ç”¨{â€¦}->æˆ–<-{â€¦}å°‡é€™printçš„å€¼å­˜å‡ºä¾†ã€‚
æ­¤æ™‚å¯ä»¥çœç•¥return()ã€‚

å¯:
use map to wrap around non-vectorized function
ç”¢ç”Ÿvectorized function
```{r}
grade[[1]] %>% {pass_or_fail(.)}
grade[[2]] %>% {pass_or_fail(.)}
grade[[3]] %>% {pass_or_fail(.)}

map(grade, ~{pass_or_fail(.)}) # map to list

map_chr(grade, ~{pass_or_fail(.)}) # map to atom. vector of class character

map_pass_fail <- function(grade){
  map_chr(grade, ~{pass_or_fail(.)})
}
```

```{r}
map_pass_fail(grade)
```

è‹¥ä½ ç¢ºä¿¡ä½ mapçš„listè¼¸å‡ºæ¯å€‹å…ƒç´ åªæœ‰ä¸€å€‹å€¼ï¼Œä¸”å¤§å®¶éƒ½ç›¸åŒclassï¼Œå‰‡ä½ å¯ä»¥ä¾classçš„é¡å½¢ä½¿ç”¨ï¼š
map_chr
map_lgl
map_dbl, map_int
çœäº†unlisté‚£ä¸€æ­¥ã€‚

è«‹å•map_pass_failçš„å®šç¾©æ˜¯å¦å—global environmentè£¡çš„gradeå…ƒç´ ã€Œå€¼ã€å½±éŸ¿ï¼Ÿå³åŸ·è¡Œrm(grade)åˆªé™¤gradeç‰©ä»¶ï¼Œä»¥ä¸‹ç¨‹åºåŸ·è¡Œä¸Šæœƒä¸æœƒæœ‰å•é¡Œï¼Ÿ
```{r}
rm(grade)
map_pass_fail(c(77,43,68,NA))
#å¯¦éš›ä¸Šæ˜¯å¯ä»¥è¢«åŸ·è¡Œçš„ï¼Œä»£è¡¨map_pass_failçš„gradeæ ¹æœ¬ä¸æ˜¯æŒ‡global environmentè£¡é¢çš„gradeï¼Œä»–å…¶å¯¦åªæ˜¯ä¸€å€‹input argument
```
å¸¸è¢«æ‹¿ä¾†é‡å°ç‰©ä»¶å…ƒç´ é€²è¡Œä¸€ä¸€è¨ˆç®—çš„å‡½æ•¸å»ºè­°å¯ä»¥å°‡å®ƒæ”¹æˆvectorized functionï¼Œä»¥å¾Œåœ¨ç¶­è­·æ™‚æ¯”è¼ƒå®¹æ˜“ã€‚


Internal dispatchingçš„å„ªå‹¢:
ç•¶Bodyè¦åŒæ™‚å°å¤šå€‹ç‰©ä»¶åŒæ™‚é€²è¡Œã€Œå…ƒç´ ä¸€ä¸€è™•ç†ã€æ™‚ï¼Œinternal dispatchä¾¿é¡¯å¾—ä¾¿åˆ©ï¼š
```{r}
eggs <- rep("é›è›‹x1",10)
ham <- rep("ç«è…¿x1", 10)
toast <- rep("åœŸå¸2ç‰‡",10)

toast_withEggHam <- function(toast=NULL, egg=NULL, ham=NULL){
  if(is.null(toast) || !str_detect(toast, "åœŸå¸")){stop("å°‘äº†åœŸå¸")}
  if(is.null(egg) || !str_detect(egg, "è›‹")){stop("å°‘äº†è›‹")}
  if(is.null(ham) || !str_detect(ham, "ç«è…¿")){stop("å°‘äº†ç«è…¿")}
  "ç«è…¿è›‹ä¸‰æ˜æ²»"
}

toast_withEggHam(toast[[1]],eggs[[1]],ham[[1]])

# åœŸå¸ã€ç«è…¿ã€è›‹ ç¬¬ä¸€ä»½å‡ºåˆ—
1 %>% {toast_withEggHam(toast=toast[[.]], egg=eggs[[.]], ham=ham[[.]])}
# åœŸå¸ã€ç«è…¿ã€è›‹ ç¬¬äºŒä»½å‡ºåˆ—
2 %>% {toast_withEggHam(toast=toast[[.]], egg=eggs[[.]], ham=ham[[.]])}
# åœŸå¸ã€ç«è…¿ã€è›‹ ç¬¬ä¸‰ä»½å‡ºåˆ—
3 %>% {toast_withEggHam(toast=toast[[.]], egg=eggs[[.]], ham=ham[[.]])}

map(1:10,~{toast_withEggHam(toast=toast[[.x]], egg=eggs[[.x]], ham=ham[[.x]])})
map(1:10,
    ~toast_withEggHam(toast=toast[[.x]], egg=eggs[[.x]], ham=ham[[.x]]))
```


å„ç³»èª²ç¨‹è¦åŠƒ
åŸ·è¡Œä»¥ä¸‹ç¨‹åºå¯ä»¥å¾—åˆ°è‡ºåŒ—å¤§å­¸100-107å­¸å¹´çš„é–‹èª²è³‡æ–™courseStructureï¼š
```{r}
jsonlite::fromJSON("https://www.dropbox.com/s/7myzzdnoor21hye/courseStructure2.json?dl=1") -> courseStructure
```


ä¸€ä½å‰›å…¥å­¸çš„ç¶“æ¿Ÿç³»æ–°ç”Ÿæƒ³å¤§è‡´äº†è§£ä»–ç³»ä¸Šå°ä»–æœªä¾†å››å¹´çš„èª²ç¨‹è¦åŠƒæ˜¯ä»€éº¼ï¼Ÿæ–¼æ˜¯ä»–æƒ³å…ˆçœ‹ä¸€ä¸‹éå»ç‹€æ³ã€‚
ä»¥100å­¸å¹´å…¥å­¸ä¹‹ç¶“æ¿Ÿç³»å­¸ç”Ÿç‚ºå°è±¡ï¼Œæ‰¾å‡ºé€™ç¾¤å­¸ç”Ÿå¤§ä¸€åˆ°å¤§å››çš„ç³»ä¸Šèª²ç¨‹è¦åŠƒæ˜¯ä»€éº¼ï¼Ÿ

Hard labour stage:
```{r}
entranceYear <- 100
major <- "ç¶“æ¿Ÿç³»"
allGrades <- paste0(major, 1:4)
academicYears <- entranceYear+0:3

# 100å­¸å¹´ 1å¹´ç´š
acadYear_i <- academicYears[[1]]
grade_i <- allGrades[[1]]
pick <-
  (courseStructure$å­¸å¹´==acadYear_i 
    &
    str_detect(courseStructure$æ‡‰ä¿®ç³»ç´š, grade_i))
unique(courseStructure$ç§‘ç›®åç¨±[pick])
#uniqueæ˜¯é é˜²æœ‰ä¸€å€‹ç§‘ç›®é–‹è¶…éä¸€ç­

# 101å­¸å¹´ 2å¹´ç´š
acadYear_i <- academicYears[[2]]
grade_i <- allGrades[[2]]
pick <-
  (courseStructure$å­¸å¹´==acadYear_i 
    &
    str_detect(courseStructure$æ‡‰ä¿®ç³»ç´š, grade_i))
unique(courseStructure$ç§‘ç›®åç¨±[pick])

# 102å­¸å¹´ 3å¹´ç´š
acadYear_i <- academicYears[[3]]
grade_i <- allGrades[[3]]
pick <-
  (courseStructure$å­¸å¹´==acadYear_i 
    &
    str_detect(courseStructure$æ‡‰ä¿®ç³»ç´š, grade_i))
unique(courseStructure$ç§‘ç›®åç¨±[pick])

# 103å­¸å¹´ 4å¹´ç´š
acadYear_i <- academicYears[[4]]
grade_i <- allGrades[[4]]
pick <-
  (courseStructure$å­¸å¹´==acadYear_i 
    &
    str_detect(courseStructure$æ‡‰ä¿®ç³»ç´š, grade_i))
unique(courseStructure$ç§‘ç›®åç¨±[pick])
```


Observant stage:
A.100å­¸å¹´1å¹´ç´š-103å­¸å¹´4å¹´ç´šï¼Œæœ‰å“ªå¹¾è¡Œæ˜¯ä¸€æ¨¡ä¸€æ¨£çš„ï¼Ÿ
```{r}
pick <-
  (courseStructure$å­¸å¹´==acadYear_i 
    &
    str_detect(courseStructure$æ‡‰ä¿®ç³»ç´š, grade_i))
unique(courseStructure$ç§‘ç›®åç¨±[pick])
```

B.ä»¥ä¸Šçš„SOPè¦èƒ½é‹ä½œï¼Œå“ªäº›ç‰©ä»¶è¦å­˜åœ¨åŸ·è¡Œç’°å¢ƒï¼Ÿ
courseStructure, acadYear_i, grade_i




Efficiency kick up stage:
å°‡(A)(B)å½¢æˆå‡½æ•¸
```{r}
#æŠŠSOPå¯«åœ¨body
get_courses <- function(acadYear_i, grade_i, courseStructure){
  pick <-
  (courseStructure$å­¸å¹´==acadYear_i 
    &
    str_detect(courseStructure$æ‡‰ä¿®ç³»ç´š, grade_i))
  
  return(
    unique(courseStructure$ç§‘ç›®åç¨±[pick])
  )
}
```


é‡å¯«100å­¸å¹´1å¹´ç´š-103å­¸å¹´4å¹´ç´š
```{r}
# 100å­¸å¹´ 1å¹´ç´š
acadYear_i <- academicYears[[1]]
grade_i <- allGrades[[1]]
get_courses(acadYear_i, grade_i, courseStructure)

# 101å­¸å¹´ 2å¹´ç´š
acadYear_i <- academicYears[[2]]
grade_i <- allGrades[[2]]
get_courses(acadYear_i, grade_i, courseStructure)

# 102å­¸å¹´ 3å¹´ç´š
acadYear_i <- academicYears[[3]]
grade_i <- allGrades[[3]]
get_courses(acadYear_i, grade_i, courseStructure)

# 103å­¸å¹´ 4å¹´ç´š
acadYear_i <- academicYears[[4]]
grade_i <- allGrades[[4]]
get_courses(acadYear_i, grade_i, courseStructure)
```


Efficiency squeezing stage:
æ¿ƒç¸®
```{r}
# 100å­¸å¹´ 1å¹´ç´š
get_courses(academicYears[[1]], allGrades[[1]], courseStructure)

# 101å­¸å¹´ 2å¹´ç´š
get_courses(academicYears[[2]], allGrades[[2]], courseStructure)

# 102å­¸å¹´ 3å¹´ç´š
get_courses(academicYears[[3]], allGrades[[3]], courseStructure)

# 103å­¸å¹´ 4å¹´ç´š
get_courses(academicYears[[4]], allGrades[[4]], courseStructure)
```

ä½¿ç”¨pipe
```{r}
1 %>% 
  {get_courses(academicYears[[.]], allGrades[[.]], courseStructure)}
2 %>% 
  {get_courses(academicYears[[.]], allGrades[[.]], courseStructure)}
3 %>% 
  {get_courses(academicYears[[.]], allGrades[[.]], courseStructure)}
4 %>% 
  {get_courses(academicYears[[.]], allGrades[[.]], courseStructure)}
```

ä½¿ç”¨map
```{r}
1:4 %>%
  map(~{get_courses(academicYears[[.]], allGrades[[.]], courseStructure)})
```




5.4.3 for loop
```{r}
output <- vector("{type}", length={len})
for(.x in {sequence}){
  {body}
}
#è¿´åœˆåŸºæœ¬ä¸Šéƒ½æœƒæœ‰sequenceå’ŒbodyåŠæ€éº¼å„²å­˜çš„outputçš„éƒ¨åˆ†
```
mapå’Œforçš„å·®åˆ¥ï¼š
map(sequence,body)ï¼Œmapçš„outputæ°¸é æœƒæ˜¯ä¸€å€‹listï¼Œmapæœƒç›¡é‡æŠŠbodyæ¿ƒç¸®ç‚ºä¸€å€‹å¾ˆç°¡çŸ­çš„formulaï¼Œç•¶bodyå¾ˆé›£ç°¡åŒ–æ™‚ï¼Œä½¿ç”¨forè¿´åœˆè¼ƒä½³

é€™è£¡"{â€¦}" å‡æ˜¯éœ€è¦è¦–æƒ…æ³å®šç¾©çš„éƒ¨ä»½ã€‚

vector(mode, length):
mode: character classï¼Œä»£è¡¨containeræ‰€è¦ç”¨ä¾†è£çš„å€¼ä¹‹typeã€‚
length: integer classï¼Œä»£è¡¨containerè¦æœ‰å¹¾å€‹ç©ºä½ã€‚é•·åº¦æ˜¯ä¸€å€‹æ•¸å­—


mapç¯„ä¾‹ï¼š
map iterationï¼š(è«‹å…ˆè·‘å‰ç½®ä½œæ¥­)
```{r}
### å‰ç½®ä½œæ¥­
entranceYear <- 100
major <- "ç¶“æ¿Ÿç³»"
allGrades <- paste0(major, 1:4)
academicYears <- entranceYear+0:3

jsonlite::fromJSON("https://www.dropbox.com/s/7myzzdnoor21hye/courseStructure2.json?dl=1") -> courseStructure

get_courses <- function(acadYear_i, grade_i, courseStructure){
  pick <-
  (courseStructure$å­¸å¹´==acadYear_i 
    &
    str_detect(courseStructure$æ‡‰ä¿®ç³»ç´š, grade_i))
  
  return(
    unique(courseStructure$ç§‘ç›®åç¨±[pick])
  )
}
```

```{r}
# å‰ç½®ä½œæ¥­ï¼Œæ¥map iteration
map(1:4, 
    ~{
      get_courses(academicYears[[.x]], 
              allGrades[[.x]], 
              courseStructure)})

#é€™è£1:4æ˜¯sequenceï¼Œ
```

for iterationï¼šï¼ˆè«‹å…ˆè·‘å‰ç½®ä½œæ¥­ï¼‰
```{r}
# å‰ç½®ä½œæ¥­ï¼Œæ¥for iterationï¼Œforè¿´åœˆï¼š
output <- vector("list", length=4)
for(.x in 1:4){
  get_courses(academicYears[[.x]], 
                allGrades[[.x]], 
                courseStructure) -> output[[.x]]
}
```
è‹¥internal dispatching sequenceçš„é•·åº¦æ˜¯å°æ‡‰åˆ°æŸå€‹ç‰©ä»¶å…ƒç´ å€‹æ•¸ï¼Œå¦‚ä¸Šé¢1:4æ˜¯å°æ‡‰academicYearsï¼ˆäº¦å°æ‡‰allGradesï¼‰ï¼Œå‰‡1:4å¯ç”¨seq_along(academiYears)å–ä»£ã€‚



ç«è…¿è›‹ä¸‰æ˜æ²»:
```{r}
eggs <- rep("é›è›‹x1",10)
ham <- rep("ç«è…¿x1", 10)
toast <- rep("åœŸå¸2ç‰‡",10)

toast_withEggHam <- function(toast=NULL, egg=NULL, ham=NULL){
  if(is.null(toast) || !str_detect(toast, "åœŸå¸")){stop("å°‘äº†åœŸå¸")}
  if(is.null(egg) || !str_detect(egg, "è›‹")){stop("å°‘äº†è›‹")}
  if(is.null(ham) || !str_detect(ham, "ç«è…¿")){stop("å°‘äº†ç«è…¿")}
  "ç«è…¿è›‹ä¸‰æ˜æ²»"
}
```

map approach:
```{r}
map(1:10,
    ~{toast_withEggHam(toast=toast[[.x]], egg=eggs[[.x]], ham=ham[[.x]])})
```

for approach:
```{r}
output <- vector("character", 10)
for(.x in 1:10){
  toast_withEggHam(toast=toast[[.x]], egg=eggs[[.x]], ham=ham[[.x]]) -> output[[.x]]
} #è¦æœ‰ä¸€å€‹å›å­˜outputçš„å‹•ä½œï¼Œå› ç‚ºforè¿´åœˆéœ€è¦è‡ªå·±æº–å‚™ä¸€å€‹output container
output
```

ç´¯è¨ˆå‹output:
Summationï¼š
```{r}
a <- sample(1:100, 10, replace=T)
print(a)
```

Sequence: 1:10
body: åˆ°ç›®å‰sequence .xå‰å·²ç¶“åŠ ç¸½çš„å€¼+ a[[.x]]
output: .xåˆ°10æœ€å¾Œç®—å®Œçš„å€¼ã€‚

```{r}
sum <- 0
sum <- sum+a[[1]]
sum <- sum+a[[2]]
sum <- sum+a[[3]]
sum <- sum+a[[4]]
sum <- sum+a[[5]]
sum <- sum+a[[6]]
sum <- sum+a[[7]]
sum <- sum+a[[8]]
sum <- sum+a[[9]]
sum <- sum+a[[10]]
sum
```
å¦‚æœè¦å¯«æˆforè¿´åœˆå°±è¦å¯«æˆä¸²æ¥å¯«æ³•
```{r}
1 %>% {sum <- sum+a[[.]]}
2 %>% {sum <- sum+a[[.]]}
3 %>% {sum <- sum+a[[.]]}
4 %>% {sum <- sum+a[[.]]}
5 %>% {sum <- sum+a[[.]]}
6 %>% {sum <- sum+a[[.]]}
7 %>% {sum <- sum+a[[.]]}
8 %>% {sum <- sum+a[[.]]}
9 %>% {sum <- sum+a[[.]]}
10 %>% {sum <- sum+a[[.]]}
```

å¯«æˆforè¿´åœˆ
```{r}
sum <- 0
for (.x in 1:10) {
  sum <- sum+a[[.x]]
}

sum
```



```{r}
sum <- 0
for(.x in 1:10){
  sum <- sum+a[[.x]]
}

print(sum)
```



é•·åº¦ä¸å®šå‹output:
æ¯æ¬¡æŠ½ä¸€å€‹ä»‹æ–¼0åˆ°100çš„æ•¸å­—ï¼ˆæŠ½å‡ºæ”¾å›ï¼‰æŠ½10æ¬¡ï¼Œä½†æ¯æ¬¡å¿…éœ€æ˜¯3çš„å€æ•¸æ‰ç•™ä¸‹ä¾†ã€‚
```{r}
output <- c()

#.x=1æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}

#.x=2æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}

#.x=3æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}

#.x=4æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}

#.x=5æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}
```
å¯«æˆä¸²æ¥
```{r}
1 %>% {#.x=1æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}}

2 %>% {#.x=2æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}}

3 %>% {#.x=3æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}}

4 %>% {#.x=4æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}}

5 %>% {#.x=5æŠ½ç¬¬ä¸€å€‹æ•¸
new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}}
```

å¯«æˆforè¿´åœˆ
```{r}
output <- c() #å¾ç©ºç›¸é‡é–‹å§‹
for (.x in 1:10) {
  new <- sample(0:100,1)
if(new %% 3 == 0){
  output <- c(output,new)
}
}

print(output)
```

next:
æœ‰æ™‚.xå°æ‡‰å…ƒç´ è¦é™„åˆæŸäº›æ¢ä»¶æ‰è¦é€²è¡Œbodyè£¡æŸäº›è™•ç†ï¼Œä¸ç„¶å¯ã€Œè·³éã€ã€‚
```{r}
list(
  list("student A", c(2,3,4,5)),
  list("student B", NA), # æ²’äº¤ä½œæ¥­
  list("student C", factor(c(2,3,4,5))),
  list("student D", factor(c(2,3,5)))
) -> collectionHWs

correctAns <- factor(c(2,3,4,5))

output <- vector("integer",length(collectionHWs))
nameVector <- vector("character", length(collectionHWs))
for(.x in seq_along(collectionHWs)){
  nameVector[[.x]] <- collectionHWs[[.x]][[1]]
  studentAns <- collectionHWs[[.x]][[2]] 
  if(is.na(studentAns)){
    output[[.x]] <- 0
    next
  } 
  
  # æ”¹é¡Œéƒ¨ä»½
  if(identical(studentAns, correctAns)){
    output[[.x]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[.x]] <- 5
  } else {
    output[[.x]] <- 0
  }
}
names(output) <- nameVector

print(output)
```

```{r}
#ç¬¬ä¸€å€‹å­¸ç”Ÿ
nameVector[[1]] <- collectionHWs[[1]][[1]]
studentAns <- collectionHWs[[1]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[1]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[1]] <- 5
  } else {
    output[[1]] <- 0
  }

#ç¬¬äºŒå€‹å­¸ç”Ÿ
nameVector[[2]] <- collectionHWs[[2]][[1]]
studentAns <- collectionHWs[[2]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[2]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[2]] <- 5
  } else {
    output[[2]] <- 0
  }

#ç¬¬ä¸‰å€‹å­¸ç”Ÿ
nameVector[[3]] <- collectionHWs[[3]][[1]]
studentAns <- collectionHWs[[3]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[3]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[3]] <- 5
  } else {
    output[[3]] <- 0
  }

#ç¬¬å››å€‹å­¸ç”Ÿ
nameVector[[4]] <- collectionHWs[[4]][[1]]
studentAns <- collectionHWs[[4]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[4]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[4]] <- 5
  } else {
    output[[4]] <- 0
  }

output
```

è®Šæˆä¸²æ¥å½¢å¼
```{r}
1 %>% {#ç¬¬ä¸€å€‹å­¸ç”Ÿ
nameVector[[.]] <- collectionHWs[[.]][[1]]
studentAns <- collectionHWs[[.]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[.]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[.]] <- 5
  } else {
    output[[.]] <- 0
  }}


2 %>% {#ç¬¬äºŒå€‹å­¸ç”Ÿ
nameVector[[.]] <- collectionHWs[[.]][[1]]
studentAns <- collectionHWs[[.]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[.]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[.]] <- 5
  } else {
    output[[.]] <- 0
  }}

3 %>% {#ç¬¬ä¸‰å€‹å­¸ç”Ÿ
nameVector[[.]] <- collectionHWs[[.]][[1]]
studentAns <- collectionHWs[[.]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[.]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[.]] <- 5
  } else {
    output[[.]] <- 0
  }}

4 %>% {#ç¬¬å››å€‹å­¸ç”Ÿ
nameVector[[.]] <- collectionHWs[[.]][[1]]
studentAns <- collectionHWs[[.]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[.]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[.]] <- 5
  } else {
    output[[.]] <- 0
  }}

output
```

å¯«æˆforè¿´åœˆ
```{r}
for (.x in 1:4) {
  nameVector[[.x]] <- collectionHWs[[.x]][[1]]
studentAns <- collectionHWs[[.x]][[2]]
#æ”¹é¡Œ
if(identical(studentAns, correctAns)){
    output[[.x]] <- 10
  } else if (class(studentAns)!=class(correctAns) && identical(as.character(studentAns),as.character(correctAns))) {
    output[[.x]] <- 5
  } else {
    output[[.x]] <- 0
  }}

```

è‹¥æ²’æœ‰äº¤ä½œæ¥­ï¼Œç›´æ¥æ”¹é›¶åˆ†ï¼Œä¸ç”¨é€²å…¥æ”¹é¡Œç¨‹å¼
```{r}
if(is.na(studentAns)){
  output[[.x]] <- 0
  next()
}
```

ex:
å°‡bodyçš„æ”¹é¡Œéƒ¨ä»½å¦å¤–å¯«æˆgrade(studentAns, correctAns)å‡½æ•¸ï¼Œè®“å®ƒæ”¹å®Œå¾Œå›å‚³åˆ†æ•¸å€¼ï¼Œä¸¦é‡å¯«ä¸Šé¢è¿´åœˆä½¿ç”¨ä½ çš„gradeå‡½æ•¸ã€‚


5.4.4 while loop
æœ‰æ™‚æˆ‘å€‘é¢è‡¨sequenceé•·åº¦æœªçŸ¥ï¼Œå¦‚æ“²ä¸€éŠ…æ¿ç›´åˆ°å‡ºç¾5æ¬¡æ­£é¢æ‰åœã€‚
```{r}
sum <- 0 #å¾—åˆ°å¹¾å€‹æ­£é¢
count <- 0 #è¨ˆæ“²äº†å¹¾æ¬¡

#1st toss
count <- count+1 #è¨ˆæ•¸å™¨+1
newToss <- sample(c("æ­£","å"),1,replace = T)
if(newToss=="æ­£"){
  sum <- sum+1
}

#2st toss
count <- count+1 #è¨ˆæ•¸å™¨+1
newToss <- sample(c("æ­£","å"),1,replace = T)
if(newToss=="æ­£"){
  sum <- sum+1
}


```

è®Šæˆä¸²æ¥
```{r}
#1st toss
1 %>% {count <- count+1 #è¨ˆæ•¸å™¨+1
newToss <- sample(c("æ­£","å"),1,replace = T)
if(newToss=="æ­£"){
  sum <- sum+1
}}

#2st toss
2 %>% {count <- count+1 #è¨ˆæ•¸å™¨+1
newToss <- sample(c("æ­£","å"),1,replace = T)
if(newToss=="æ­£"){
  sum <- sum+1
}}

#sequenceä¸çŸ¥é“å¤šä¹…æ‰æœƒåœä¸‹ä¾†
```



```{r}
sum <- 0
for(i in 1:10){
  newToss <- sample(c("æ­£","å"), 1, replace=T)
  if(newToss == "æ­£"){
    sum <- sum+1
  }
  print(glue::glue("å·²æ“²{i}æ¬¡å¾—åˆ°{sum}æ¬¡æ­£é¢"))
}
```

for loopç”¨å¾ˆé•·çš„sequenceå†åŠ ä¸Šæ¢ä»¶å¼breakï¼š
```{r}
sum <- 0
count <- 0
for(i in 1:100){
  count <- count+1 #è¨ˆæ•¸å™¨+1
newToss <- sample(c("æ­£","å"),1,replace = T)
if(newToss=="æ­£"){
  sum <- sum+1
  }
  print(glue::glue("å·²æ“²{i}æ¬¡å¾—åˆ°{sum}æ¬¡æ­£é¢"))
  if(sum==5){
    break
  }
}
```
breakæœƒå®Œå…¨çµ‚æ­¢è¿´åœˆï¼Œè€Œä¹‹å‰å­¸åˆ°çš„nextæ˜¯ä¸åŸ·è¡Œå…¶ä»¥ä¸‹çš„bodyç›´æ¥è·³ä¸‹ä¸€å€‹sequenceå€¼ã€‚
forçš„breakæ˜¯è·³å‡ºè¿´åœˆçš„æ¢ä»¶ï¼Œwhileæ˜¯ç•™åœ¨è¿´åœˆçš„æ¢ä»¶
whileæœƒä¸€ç›´åè¦†åŸ·è¡Œbodyç›´åˆ°conditionConditionç‚ºFALSE:
```{r}
while(continueCondition){
  body
}
```

```{r}
sum <- 0
count <- 0
while(sum!=5){
   count <- count+1 #è¨ˆæ•¸å™¨+1
newToss <- sample(c("æ­£","å"),1,replace = T)
if(newToss=="æ­£"){
  sum <- sum+1
  }
}
```



```{r}
sum <- 0
count <- 0 # è¨ˆæ•¸å™¨
while(sum<5){
  count <- count+1 # è¨ˆæ•¸å™¨+1
  newToss <- sample(c("æ­£","å"), 1, replace=T)
  if(newToss == "æ­£"){
    sum <- sum+1
  }
  print(glue::glue("å·²æ“²{count}æ¬¡å¾—åˆ°{sum}æ¬¡æ­£é¢"))
}
```
ç”±æ–¼whileä¸¦æ²’æœ‰è¿´åœˆåŸ·è¡Œæ¬¡æ•¸ä¸Šé™ï¼Œè‹¥æ²’è¨­å¥½çµæŸæ¢ä»¶ç¨‹å¼æœƒä¸€ç›´è·‘ä¸‹å»é–æ­»é›»è…¦ã€‚ç‚ºé¿å…æ­¤å•é¡Œï¼Œä¸€èˆ¬æˆ‘å€‘æœƒæ”¾è¨ˆæ•¸å™¨ï¼Œä¸¦åœ¨æ¢ä»¶è£¡æ”¾è¨ˆæ•¸ä¸Šé™ï¼Œå¦‚ä¸‹æ–¹å››å€‹#è¨»æ˜ä½ç½®ï¼š
```{r}
count <- 0 # è¨ˆæ•¸å™¨é–‹å§‹å€¼
max_count <- 500 # è¨ˆæ•¸ä¸Šé™
while(continueCondition && count <= max_count){ # å¢åŠ è¨ˆæ•¸ä¸Šé™æ¢ä»¶
  count <- count+1 # è¨ˆæ•¸å™¨åŠ 1
  body
}
```


ä¹‹å‰çš„ï¼ˆæœ‰é™ï¼‰è¿´åœˆä¹Ÿå¯ä»¥ç”¨whileå¯«ï¼š
```{r}
set.seed(1000) # æ§åˆ¶sampleæŠ½å‡ºçš„æ•¸å­—sequenceå›ºå®šï¼Œé€šå¸¸é€²è¡Œæ–¹æ³•æ¯”å°ç”¨

output <- c()
for(.x in 1:10){
  new <- sample(0:100,1)
  if(new %% 3==0){
    output <- c(output, new)
  }
}

print(output)
```

```{r}
set.seed(1000) # æ§åˆ¶sampleæŠ½å‡ºçš„æ•¸å­—sequenceå›ºå®šï¼Œé€šå¸¸é€²è¡Œæ–¹æ³•æ¯”å°ç”¨

count <- 0 # è¨ˆæ•¸å™¨èµ·å§‹å€¼
output <- c()
while(count <= 10){ # è¨ˆæ•¸ä¸Šé™æ¢ä»¶
  count <- count+1 # è¨ˆæ•¸å™¨+1
  new <- sample(0:100,1)
  if(new %% 3==0){
    output <- c(output, new)
  }
}

print(output)
```

```{r}
a <- sample(1:100, 10, replace=T)
print(a)

sum <- 0
for(.x in 1:10){ 
  sum <- sum+a[[.x]]
}

print(sum)
```

```{r}
count <- 0 # è¨ˆæ•¸å™¨èµ·å§‹å€¼
sum <- 0
while(count <= 10){ # è¨ˆæ•¸ä¸Šé™æ¢ä»¶
  count <- count+1 # è¨ˆæ•¸å™¨+1
  sum <- sum+a[[count]]
}

print(sum)
```





















